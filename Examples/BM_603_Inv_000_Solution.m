(* ============================================== *)
ClearAll["Global`*"];
(* ============================================== *)
BaseDir = "C:\\GitHub\\BM\\";
PathList = {BaseDir <> "Kernel\\"};
OutDir = BaseDir <> "Calc\\";
(* ============================================== *)
OutFileName = "TEST_300_1.CSV";
(*==============================================*)
useParallelTbl = False;
Get["BerremanInit.m", Path -> PathList];
InitializeBM[PathList, useParallelTbl];
(*==============================================*)
FuncList =
    {
      Rx,
      Ry,
      Tx,
      Ty
    };
(*==============================================*)
InptRefractionElement = {1, 1.52, 1.52};
(*==============================================*)
InptList =
    {
      {"Input", "No", "lambda", "phita", "beta", "gamma", "e", "phi_1", "theta_1", "psi_1", "phi_1", "theta_1", "psi_1", "h", "Output", "R_p", "R_s", "e_r", "Sin[2 chi ]_      r"},
      {"", 1, 600, 0, 0, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.110804078096426, 0, 0, 2.98023223876953E - 08},
      {"", 2, 600, 0, 0, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0696613966774071, 0.00486178881957234, 0.041655242250827, -0.488532762702534},
      {"", 3, 600, 0, 0, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0382422928975319, 0, 0, 0},
      {"", 4, 600, 0, 0, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0696613966774071, 0.00486178881957234, -0.041655242250827, 0.488532762702534},
      {"", 5, 600, 0, 0, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.110804078096426, 0, 0, 2.98023223876953E - 08},
      {"", 6, 600, 0, 45, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0554020390482133, 0.0191211464487659, -0.0416552422508274, -0.872545551685543},
      {"", 7, 600, 0, 45, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0554020390482133, 0.0554020390482133, 0, -1},
      {"", 8, 600, 0, 45, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0191211464487659, 0.0554020390482133, 0.0416552422508272, -0.872545551685543},
      {"", 9, 600, 0, 45, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.019121146448766, 0.019121146448766, 0, -1},
      {"", 10, 600, 0, 45, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0554020390482133, 0.0191211464487659, -0.0416552422508274, -0.872545551685543},
      {"", 11, 600, 0, 90, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0382422928975319, 0, 0},
      {"", 12, 600, 0, 90, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00486178881957234, 0.0696613966774071, -0.0416552422508272, -0.488532762702533},
      {"", 13, 600, 0, 90, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.110804078096426, 0, 0},
      {"", 14, 600, 0, 90, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00486178881957234, 0.0696613966774071, 0.0416552422508272, 0.488532762702533},
      {"", 15, 600, 0, 90, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0382422928975319, 0, 0},
      {"", 16, 600, 15, 0, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.103272502818231, 0, 0, 0},
      {"", 17, 600, 15, 0, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0636367800874694, 0.00494959764881466, 0.0474034990000749, -0.511098091060577},
      {"", 18, 600, 15, 0, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0339550467261274, 0, 0, 0},
      {"", 19, 600, 15, 0, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0636367800874694, 0.00494959764881466, -0.0474034990000749, 0.511098091060577},
      {"", 20, 600, 15, 0, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.103272502818231, 0, 0, 0},
      {"", 21, 600, 15, 45, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0516362514091155, 0.0210078970705337, -0.0470555420465385, -0.905899356178648},
      {"", 22, 600, 15, 45, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0517417784652903, 0.0591346295259425, -0.00101354217224208, -0.997774636772881},
      {"", 23, 600, 15, 45, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0169775233630637, 0.0592478505063468, 0.0440521919121308, -0.830713265667019},
      {"", 24, 600, 15, 45, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0168445992709937, 0.0211582028388085, 0.00421749879760319, -0.993536676573926},
      {"", 25, 600, 15, 45, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0516362514091155, 0.0210078970705337, -0.0470555420465385, -0.905899356178648},
      {"", 26, 600, 15, 90, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0420157941410674, 0, 0},
      {"", 27, 600, 15, 90, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00494959764881466, 0.0753432347159364, -0.0438814769207592, -0.474799073986654},
      {"", 28, 600, 15, 90, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.118495701012693, 0, 0},
      {"", 29, 600, 15, 90, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00494959764881466, 0.0753432347159364, 0.0438814769207592, 0.474799073986654},
      {"", 30, 600, 15, 90, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0420157941410674, 0, 0},
      {"", 31, 600, 30, 0, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0801647897857297, 0, 0, 0},
      {"", 32, 600, 30, 0, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0456697034873117, 0.0051771344432945, 0.067660900495139, -0.595050113168115},
      {"", 33, 600, 30, 0, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0216396249418124, 0, 0, 0},
      {"", 34, 600, 30, 0, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0456697034873117, 0.0051771344432945, -0.067660900495139, 0.595050113168115},
      {"", 35, 600, 30, 0, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0801647897857297, 0, 0, 0},
      {"", 36, 600, 30, 45, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0400823948928649, 0.0279029687248331, -0.0644837701786799, -0.983548577216681},
      {"", 37, 600, 30, 45, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0404137447252793, 0.0718848828783022, -0.00623934275477368, -0.959922113071666},
      {"", 38, 600, 30, 45, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0108198124709062, 0.0723335123565064, 0.0482254058769122, -0.669056774318917},
      {"", 39, 600, 30, 45, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0104330932053269, 0.0285682433272978, 0.0202994377062997, -0.885115567297382},
      {"", 40, 600, 30, 45, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0400823948928649, 0.0279029687248331, -0.0644837701786799, -0.983548577216681},
      {"", 41, 600, 30, 90, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0558059374496664, 0, 0},
      {"", 42, 600, 30, 90, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00517713444329449, 0.0952759917623057, -0.0490628979290782, -0.433293469824021},
      {"", 43, 600, 30, 90, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.144667024713012, 0, 0},
      {"", 44, 600, 30, 90, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00517713444329449, 0.0952759917623057, 0.0490628979290782, 0.433293469824021},
      {"", 45, 600, 30, 90, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0558059374496664, 0, 0},
      {"", 46, 600, 45, 0, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0421574982737933, 0, 0, 0},
      {"", 47, 600, 45, 0, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0183649525903547, 0.00539618138129457, 0.116903092953694, -0.827868342566463},
      {"", 48, 600, 45, 0, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00526382316402098, 0, 0, 0},
      {"", 49, 600, 45, 0, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0183649525903547, 0.00539618138129457, -0.116903092953694, 0.827868342566463},
      {"", 50, 600, 45, 0, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0421574982737933, 0, 0, 0},
      {"", 51, 600, 45, 45, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0210787491368966, 0.0449048104674199, -0.0913612379095069, -0.93015402106312},
      {"", 52, 600, 45, 45, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0214509050185955, 0.0994708576271171, -0.0216861519339981, -0.763491954278687},
      {"", 53, 600, 45, 45, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00263191158201049, 0.100327765458913, 0.0450646133458932, -0.303797156445875},
      {"", 54, 600, 45, 45, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00231022895305379, 0.0465788834270976, 0.0483614312115066, -0.415185947844355},
      {"", 55, 600, 45, 45, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0210787491368966, 0.0449048104674199, -0.0913612379095069, -0.93015402106312},
      {"", 56, 600, 45, 90, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0898096209348398, 0, 0},
      {"", 57, 600, 45, 90, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00539618138129457, 0.14065355967292, -0.0530087834140594, -0.364191384509499},
      {"", 58, 600, 45, 90, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.200655530917827, 0, 0},
      {"", 59, 600, 45, 90, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00539618138129457, 0.14065355967292, 0.0530087834140594, 0.364191384509499},
      {"", 60, 600, 45, 90, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.0898096209348398, 0, 0},
      {"", 61, 600, 60, 0, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00399297601078172, 0, 0, 2.98023223876953E - 08},
      {"", 62, 600, 60, 0, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.000194087783102917, 0.00517618666593363, -0.110256702329321, 0.310568532105116},
      {"", 63, 600, 60, 0, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00585740319261562, 0, 0, 2.98023223876953E - 08},
      {"", 64, 600, 60, 0, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.000194087783102917, 0.00517618666593363, 0.110256702329321, -0.310568532105116},
      {"", 65, 600, 60, 0, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00399297601078172, 0, 0, 2.98023223876953E - 08},
      {"", 66, 600, 60, 45, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00199648800539085, 0.0871490692629108, -0.0917334825083271, -0.237363082721873},
      {"", 67, 600, 60, 45, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00187124972601889, 0.156348642993904, -0.0464663749595499, -0.196162297546423},
      {"", 68, 600, 60, 45, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0029287015963078, 0.15679575197813, 0.0274543654346371, 0.263053043237039},
      {"", 69, 600, 60, 45, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00349902472301765, 0.0900722972353497, 0.0592036902913994, 0.363176682347163},
      {"", 70, 600, 60, 45, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00199648800539085, 0.0871490692629108, -0.0917334825083271, -0.237363082721873},
      {"", 71, 600, 60, 90, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.174298138525821, 0, 0},
      {"", 72, 600, 60, 90, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00517618666593363, 0.24124475356332, -0.0499229916447486, -0.270299808386598},
      {"", 73, 600, 60, 90, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.31359150395626, 0, 0},
      {"", 74, 600, 60, 90, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00517618666593363, 0.24124475356332, 0.0499229916447486, 0.270299808386598},
      {"", 75, 600, 60, 90, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.174298138525821, 0, 0},
      {"", 76, 600, 75, 0, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0674195791254922, 0, 0, 2.98023223876953E - 08},
      {"", 77, 600, 75, 0, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0976465264817692, 0.00341273448894537, -0.0772410762005023, 0.3309338000078},
      {"", 78, 600, 75, 0, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.131450009520571, 0, 0, 0},
      {"", 79, 600, 75, 0, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0976465264817692, 0.00341273448894537, 0.0772410762005023, -0.3309338000078},
      {"", 80, 600, 75, 0, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0674195791254922, 0, 0, 2.98023223876953E - 08},
      {"", 81, 600, 75, 45, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0337097895627461, 0.198750137734851, -0.0425846533183438, 0.701618275842207},
      {"", 82, 600, 75, 45, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.034006017074789, 0.274383424898321, -0.0467668361557025, 0.622175737306565},
      {"", 83, 600, 75, 45, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0657250047602859, 0.271325126753452, 0.00752119825667756, 0.79234932513007},
      {"", 84, 600, 75, 45, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0670532438959255, 0.200988599426126, 0.0359209545190608, 0.865463531843237},
      {"", 85, 600, 75, 45, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.0337097895627461, 0.198750137734851, -0.0425846533183438, 0.701618275842207},
      {"", 86, 600, 75, 90, -90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.397500275469703, 0, 0},
      {"", 87, 600, 75, 90, -45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00341273448894538, 0.471959289835502, -0.034217889636874, -0.154756472603749},
      {"", 88, 600, 75, 90, 0, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.542650253506904, 0, 0},
      {"", 89, 600, 75, 90, 45, 0, 0, 0, 0, 7, -11, 17, 75, "", 0.00341273448894538, 0.471959289835502, 0.034217889636874, 0.154756472603749},
      {"", 90, 600, 75, 90, 90, 0, 0, 0, 0, 7, -11, 17, 75, "", 0, 0.397500275469703, 0, 0}
    };
(*==============================================*)
opts =
    {
      UseEulerAngles -> False,
      RotateAll -> True,
      LambdaColumn -> 3,
      FitaColumn -> 4,
      BetaColumn -> 5,
      GammaColumn -> 6,
      EllipticityColumn -> 7,
      OutputStartColumn -> 16,
      UseEvaluationMonitor -> True,
      EvaluationMonitorCount -> 25,
      PrintEpsilon -> False,
      EpsilonType -> BIEPSTYPESTDTWOSTEPTRAPSPARENT,
      StepMonitorCount -> 1,
      EvaluationMonitorSecondStepCount -> 10,
      StepMonitorSecondStepCount -> 1
    };
(*==============================================*)
Print["Starting..."];
OutputCopyright[];
(*==============================================*)
systemDescription = "One Layer biaxial thin film on semi-infinite glass.";

invSol = InverseSolutionNew[600 nm, InptRefractionElement, {70 nm, 0}, InptList, FuncList, systemDescription, opts];
Print["invSol = ", invSol];
(*==============================================*)

eeExact =
    {
      {2.28401, -0.110156, -0.104617},
      {-0.110156, 3.01768, 0.0811717},
      {-0.104617, 0.0811717, 2.7333}
    };
(*==============================================*)
Print[strSeparatorSmall];
mf = MFHlp[eeExact, invSol];
Print[strSeparatorSmall];
Print["MF exact = ", mf];

Print[strSeparatorSmall];
epsMin = ProcessMinSolEps[eeExact, invSol];
Print["epsMin = ", epsMin];

Print[strSeparatorSmall];
invSolRun = InverseSolutionRun[invSol];
(*==============================================*)
