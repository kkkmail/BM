(* ============================================== *)
ClearAll["Global`*"];
(* ============================================== *)
BaseDir = "C:\\GitHub\\BM\\";
PathList = {BaseDir <> "Kernel\\"};
OutDir = BaseDir <> "Calc\\";
(* ============================================== *)
OutFileName = "TEST_300_1.CSV";
(*==============================================*)
useParallelTbl = False;
Get["BerremanInit.m", Path -> PathList];
InitializeBM[PathList, useParallelTbl];
(*==============================================*)
FuncList =
    {
      Rx,
      Ry,
      Tx,
      Ty
    };
(*==============================================*)
InptRefractionElement = {1, 1.52, 1.52};
InptList =
    {
      {"Input", "No", "lambda", "phita", "beta", "gamma", "e", "phi_2", "theta_2", "psi_2", "phi_1", "theta_1", "psi_1", "h", "Output", "R_p", "R_s", "T_p", "T_s"},
      {"", 1, 600, 0, 0, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.14061901607341, 0, 0.802829540469549, 0},
      {"", 2, 600, 0, 0, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.119029545069897, 0.0046913581565253, 0.811598400717594, 0.00701727606700897},
      {"", 3, 600, 0, 0, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0852333193759224, 0.0046913581565253, 0.843170673347701, 0.00701727606700897},
      {"", 4, 600, 0, 0, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0730265646854602, 0, 0.865974085729763, 0},
      {"", 5, 600, 0, 0, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0852333193759224, 0.0046913581565253, 0.843170673347701, 0.00701727606700897},
      {"", 6, 600, 0, 0, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.119029545069897, 0.0046913581565253, 0.811598400717594, 0.00701727606700897},
      {"", 7, 600, 0, 0, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.14061901607341, 0, 0.802829540469549, 0},
      {"", 8, 600, 0, 90, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.0730265646854602, 0, 0.865974085729763},
      {"", 9, 600, 0, 90, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00469135815652529, 0.0852333193759224, 0.00701727606700897, 0.843170673347701},
      {"", 10, 600, 0, 90, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0046913581565253, 0.119029545069897, 0.00701727606700898, 0.811598400717594},
      {"", 11, 600, 0, 90, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.14061901607341, 0, 0.802829540469549},
      {"", 12, 600, 0, 90, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0046913581565253, 0.119029545069897, 0.00701727606700898, 0.811598400717594},
      {"", 13, 600, 0, 90, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00469135815652529, 0.0852333193759224, 0.00701727606700897, 0.843170673347701},
      {"", 14, 600, 0, 90, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.0730265646854602, 0, 0.865974085729763},
      {"", 15, 600, 15, 0, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.130777460613173, 0, 0.811614111156244, 0},
      {"", 16, 600, 15, 0, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.109774932647851, 0.00478229032810907, 0.819625870345594, 0.00712616510265736},
      {"", 17, 600, 15, 0, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0773236883670854, 0.00474463497515326, 0.850006611821216, 0.00708114322622056},
      {"", 18, 600, 15, 0, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0658010979913703, 0, 0.87228411662289, 0},
      {"", 19, 600, 15, 0, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0773236883670854, 0.00474463497515326, 0.850006611821216, 0.00708114322622056},
      {"", 20, 600, 15, 0, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.109774932647851, 0.00478229032810907, 0.819625870345594, 0.00712616510265736},
      {"", 21, 600, 15, 0, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.130777460613173, 0, 0.811614111156244, 0},
      {"", 22, 600, 15, 90, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.0797309006465046, 0, 0.858397586052631},
      {"", 23, 600, 15, 90, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00478229032810907, 0.0926316249141649, 0.00705462101555943, 0.834856037265924},
      {"", 24, 600, 15, 90, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00474463497515326, 0.128069537781167, 0.00700979294661473, 0.801880588419396},
      {"", 25, 600, 15, 90, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.150530006840329, 0, 0.792358438146858},
      {"", 26, 600, 15, 90, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00474463497515326, 0.128069537781167, 0.00700979294661473, 0.801880588419396},
      {"", 27, 600, 15, 90, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00478229032810907, 0.0926316249141649, 0.00705462101555943, 0.834856037265924},
      {"", 28, 600, 15, 90, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.0797309006465046, 0, 0.858397586052631},
      {"", 29, 600, 30, 0, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.100259086227145, 0, 0.838915930057827, 0},
      {"", 30, 600, 30, 0, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0814094954113047, 0.00502925292786687, 0.844303829242224, 0.00746351739873937},
      {"", 31, 600, 30, 0, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0535972026163981, 0.00486946851220472, 0.870576368716517, 0.00727294958991103},
      {"", 32, 600, 30, 0, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0443407373582363, 0, 0.891054044048578, 0},
      {"", 33, 600, 30, 0, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0535972026163981, 0.00486946851220472, 0.870576368716517, 0.00727294958991103},
      {"", 34, 600, 30, 0, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0814094954113047, 0.00502925292786687, 0.844303829242224, 0.00746351739873937},
      {"", 35, 600, 30, 0, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.100259086227145, 0, 0.838915930057827, 0},
      {"", 36, 600, 30, 90, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.103717652917998, 0, 0.831831725164707},
      {"", 37, 600, 30, 90, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00502925292786687, 0.118764663440665, 0.00712127125458835, 0.806110736970441},
      {"", 38, 600, 30, 90, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00486946851220473, 0.159164262117336, 0.00693432860293194, 0.768950596098709},
      {"", 39, 600, 30, 90, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.184173575169194, 0, 0.757161286372829},
      {"", 40, 600, 30, 90, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00486946851220473, 0.159164262117336, 0.00693432860293194, 0.768950596098709},
      {"", 41, 600, 30, 90, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00502925292786687, 0.118764663440665, 0.00712127125458835, 0.806110736970441},
      {"", 42, 600, 30, 90, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.103717652917998, 0, 0.831831725164707},
      {"", 43, 600, 45, 0, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0496087255169687, 0, 0.884165655391524, 0},
      {"", 44, 600, 45, 0, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0358288142807336, 0.00532188175572254, 0.883895859224662, 0.00803474710438841},
      {"", 45, 600, 45, 0, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0179799144468758, 0.00493713250353679, 0.901326238871486, 0.00757340472513226},
      {"", 46, 600, 45, 0, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0132977436650018, 0, 0.917946397497462, 0},
      {"", 47, 600, 45, 0, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0179799144468758, 0.00493713250353679, 0.901326238871486, 0.00757340472513226},
      {"", 48, 600, 45, 0, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0358288142807336, 0.00532188175572254, 0.883895859224662, 0.00803474710438841},
      {"", 49, 600, 45, 0, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.0496087255169687, 0, 0.884165655391524, 0},
      {"", 50, 600, 45, 90, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.159869639735097, 0, 0.771628790512441},
      {"", 51, 600, 45, 90, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00532188175572255, 0.178444473009074, 0.00704925765802183, 0.74272109989526},
      {"", 52, 600, 45, 90, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00493713250353679, 0.226557488231683, 0.00660939896185055, 0.699318690937869},
      {"", 53, 600, 45, 90, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.255201701204302, 0, 0.684069786081429},
      {"", 54, 600, 45, 90, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00493713250353679, 0.226557488231683, 0.00660939896185055, 0.699318690937869},
      {"", 55, 600, 45, 90, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00532188175572255, 0.178444473009074, 0.00704925765802183, 0.74272109989526},
      {"", 56, 600, 45, 90, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.159869639735097, 0, 0.771628790512441},
      {"", 57, 600, 60, 0, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00529314657128023, 0, 0.921291322797283, 0},
      {"", 58, 600, 60, 0, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00225513110457906, 0.00534257289333981, 0.910222118001002, 0.00866080288639904},
      {"", 59, 600, 60, 0, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00354646533615499, 0.00466615184208108, 0.910508573452662, 0.0078310614213615},
      {"", 60, 600, 60, 0, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00715278205502113, 0, 0.919568939771652, 0},
      {"", 61, 600, 60, 0, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00354646533615499, 0.00466615184208108, 0.910508573452662, 0.0078310614213615},
      {"", 62, 600, 60, 0, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00225513110457906, 0.00534257289333981, 0.910222118001002, 0.00866080288639904},
      {"", 63, 600, 60, 0, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00529314657128023, 0, 0.921291322797283, 0},
      {"", 64, 600, 60, 90, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.284657502911752, 0, 0.642232478885749},
      {"", 65, 600, 60, 90, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00534257289333981, 0.306601030024811, 0.00648286590199347, 0.611450971906815},
      {"", 66, 600, 60, 90, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00466615184208108, 0.360943968696311, 0.00570714129880168, 0.564021173371391},
      {"", 67, 600, 60, 90, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.391616205884419, 0, 0.546205039742698},
      {"", 68, 600, 60, 90, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00466615184208108, 0.360943968696311, 0.00570714129880168, 0.564021173371391},
      {"", 69, 600, 60, 90, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00534257289333981, 0.306601030024811, 0.00648286590199347, 0.611450971906815},
      {"", 70, 600, 60, 90, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.284657502911752, 0, 0.642232478885749},
      {"", 71, 600, 75, 0, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.145926347343568, 0, 0.773609443775779, 0},
      {"", 72, 600, 75, 0, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.158725597547524, 0.00452307282008708, 0.749014214591123, 0.0082124150900699},
      {"", 73, 600, 75, 0, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.185393476359545, 0.00386488500597139, 0.726328738162409, 0.00740507604085235},
      {"", 74, 600, 75, 0, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.199942343074375, 0, 0.724682407585457, 0},
      {"", 75, 600, 75, 0, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.185393476359545, 0.00386488500597139, 0.726328738162409, 0.00740507604085235},
      {"", 76, 600, 75, 0, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.158725597547524, 0.00452307282008708, 0.749014214591123, 0.0082124150900699},
      {"", 77, 600, 75, 0, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.145926347343568, 0, 0.773609443775779, 0},
      {"", 78, 600, 75, 90, -90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.543411002920728, 0, 0.381420372612974},
      {"", 79, 600, 75, 90, -60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00452307282008649, 0.562314266707297, 0.0051605949789741, 0.357083609496755},
      {"", 80, 600, 75, 90, -30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00386488500597091, 0.607658371334415, 0.00411081831202654, 0.320691657387944},
      {"", 81, 600, 75, 90, 0, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.631918757727258, 0, 0.30741378267973},
      {"", 82, 600, 75, 90, 30, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00386488500597091, 0.607658371334415, 0.00411081831202654, 0.320691657387944},
      {"", 83, 600, 75, 90, 60, 0, 0, 0, 0, -11, 17, 17, 75, "", 0.00452307282008649, 0.562314266707297, 0.0051605949789741, 0.357083609496755},
      {"", 84, 600, 75, 90, 90, 0, 0, 0, 0, -11, 17, 17, 75, "", 0, 0.543411002920728, 0, 0.381420372612974}
    };
(*==============================================*)
opts =
    {
      RotateAll -> True,
      LambdaColumn -> 3,
      FitaColumn -> 4,
      BetaColumn -> 5,
      GammaColumn -> 6,
      EllipticityColumn -> 7,
      OutputStartColumn -> 16,
      UseEvaluationMonitor -> True,
      EvaluationMonitorCount -> 25,
      PrintEpsilon -> False,
      EpsilonType -> BIEPSTYPESTDTWOSTEPTRAPSPARENT,
      StepMonitorCount -> 1,
      EvaluationMonitorSecondStepCount -> 10,
      StepMonitorSecondStepCount -> 1
    };
(*==============================================*)
Print["Starting..."];
OutputCopyright[];

invSol = InverseSolutionNew[600 nm, InptRefractionElement, {70 nm, 0}, InptList, FuncList, "No Description", opts];
Print["invSol = ", invSol];
(*==============================================*)

eeExact =
    {
      {2.28401, -0.110156, -0.104617},
      {-0.110156, 3.01768, 0.0811717},
      {-0.104617, 0.0811717, 2.7333}
    };
(*==============================================*)
Print[strSeparatorSmall];
mf = MFHlp[eeExact, invSol];
Print[strSeparatorSmall];
Print["MF exact = ", mf];

Print[strSeparatorSmall];
epsMin = ProcessMinSolEps[eeExact, invSol];
Print["epsMin = ", epsMin];

Print[strSeparatorSmall];
invSolRun = InverseSolutionRun[invSol];
(*==============================================*)
