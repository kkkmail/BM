PathList={"C:\\Math\\", "C:\\"};
BaseDir="C:\\Math\\"; BaseFileName="TC_"; OutDir=BaseDir <>"Calc\\"; OutFileName="TEST_300_1.CSV";
(*==============================================*)
useParallelTbl=True;
Get["BerremanInit.m",Path-> PathList];
Initialize[PathList, useParallelTbl];
(*==============================================*)
(* opts={UseThickLastLayer  False,  PrintTimeEstimate  True, RotateAll True}; *)
(* ConsecutiveRotation  True *)
(*==============================================*)
InptRefractionElement = {1, 1.52, 1.52};
InptList={{"Input","No","Lambda","Fita","Beta","Gamma","ellipticity","Fi","Teta","Psi","Fi","Teta","Psi","h","Output",Subscript["R", "x"],Subscript["R", "y"],Subscript["T", "x"],Subscript["T", "y"]},{"",1.`,600.`,0.`,0.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.10322901449578727`,0.00032493552328485115`,0.8958132763891509`,0.0006327735917768926`},{"",2.`,600.`,0.`,0.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.07603492256295605`,0.003921819079425091`,0.9124059784440542`,0.007637279913564514`},{"",3.`,600.`,0.`,0.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.046595760870378554`,0.0019890227011755647`,0.947541829406845`,0.0038733870216009145`},{"",4.`,600.`,0.`,0.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.04048509835413304`,0.0003249355232848503`,0.9585571925308048`,0.0006327735917768912`},{"",5.`,600.`,0.`,0.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.060485423174683334`,0.003921819079425103`,0.9279554778323271`,0.007637279913564513`},{"",6.`,600.`,0.`,0.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.09379017762375992`,0.001989022701175562`,0.9003474126534635`,0.003873387021600908`},{"",7.`,600.`,0.`,0.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.1032290144957872`,0.00032493552328485115`,0.8958132763891509`,0.0006327735917768926`},{"",8.`,600.`,0.`,90.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00032493552328485045`,0.04048509835413296`,0.0006327735917768917`,0.9585571925308055`},{"",9.`,600.`,0.`,90.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0039218190794250915`,0.06048542317468342`,0.0076372799135645125`,0.9279554778323271`},{"",10.`,600.`,0.`,90.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0019890227011755595`,0.09379017762375975`,0.003873387021600909`,0.9003474126534642`},{"",11.`,600.`,0.`,90.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.000324935523284851`,0.10322901449578722`,0.0006327735917768926`,0.8958132763891511`},{"",12.`,600.`,0.`,90.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0039218190794250846`,0.0760349225629562`,0.0076372799135645125`,0.9124059784440539`},{"",13.`,600.`,0.`,90.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0019890227011755677`,0.046595760870378644`,0.0038733870216009114`,0.9475418294068445`},{"",14.`,600.`,0.`,90.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0003249355232848502`,0.04048509835413292`,0.0006327735917768915`,0.9585571925308055`},{"",15.`,600.`,15.`,0.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.09581888508696457`,0.00023898155202257515`,0.9034814605821718`,0.0004606727788412947`},{"",16.`,600.`,15.`,0.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.06969230968548978`,0.0035734292126956683`,0.919763625933633`,0.006970635168181167`},{"",17.`,600.`,15.`,0.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.041803437022524294`,0.0017444663009395526`,0.9530346447127885`,0.003417451963747041`},{"",18.`,600.`,15.`,0.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.03608640303909341`,0.0004033155422625241`,0.9627192411755187`,0.0007910402431254014`},{"",19.`,600.`,15.`,0.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.05489782356513322`,0.004019547385761744`,0.9331910709496252`,0.007891558099479525`},{"",20.`,600.`,15.`,0.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.08671705500311114`,0.0019048847120138699`,0.9076481847335228`,0.003729875551352251`},{"",21.`,600.`,15.`,0.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.09581888508696446`,0.00044016083517029657`,0.9028715773147866`,0.0008693767630784733`},{"",22.`,600.`,15.`,90.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00044016083517029586`,0.04440211298558026`,0.0004767742454674378`,0.9546809519337817`},{"",23.`,600.`,15.`,90.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.004426193181341852`,0.0655804598797442`,0.006922242444265674`,0.9230711044946484`},{"",24.`,600.`,15.`,90.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0022974995986462933`,0.10055515636936162`,0.0034120811985686823`,0.8937352628334231`},{"",25.`,600.`,15.`,90.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0002604594382947769`,0.11041266521943613`,0.0007484129233050509`,0.8885784624189638`},{"",26.`,600.`,15.`,90.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00393482608066206`,0.08194993427195614`,0.007684476611187384`,0.9064307630361945`},{"",27.`,600.`,15.`,90.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0021568759828074517`,0.0508887664293735`,0.0036751422924986518`,0.9432792152953204`},{"",28.`,600.`,15.`,90.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00023898155202257455`,0.044402112985580305`,0.0008149711987851827`,0.9545439342636116`},{"",29.`,600.`,30.`,0.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.07331990003613846`,0.00017063966845642326`,0.9261788192235367`,0.0003306410718686705`},{"",30.`,600.`,30.`,0.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.050741504231783016`,0.0033177619901441657`,0.9393293519585174`,0.006611381819555457`},{"",31.`,600.`,30.`,0.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.02785500142177856`,0.0015332467098646252`,0.9675283996859294`,0.003083352182427619`},{"",32.`,600.`,30.`,0.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.023388011410221544`,0.0004975290760116965`,0.9751128694774384`,0.0010015900363283764`},{"",33.`,600.`,30.`,0.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.038403353022361884`,0.004205466091068387`,0.94890888060991`,0.008482300276659848`},{"",34.`,600.`,30.`,0.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.06535152827018428`,0.0018806194862497714`,0.928996120079909`,0.003771732163657119`},{"",35.`,600.`,30.`,0.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.07331990003613852`,0.0005961391098139913`,0.9248716447515706`,0.0012123161024765114`},{"",36.`,600.`,30.`,90.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0005961391098139912`,0.05865944347118778`,0.00033768438863172645`,0.9404067330303664`},{"",37.`,600.`,30.`,90.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.005101885837846617`,0.08363154807727745`,0.006112675530484282`,0.905153890554392`},{"",38.`,600.`,30.`,90.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.002672229006860662`,0.12385067684092732`,0.002881921401852488`,0.8705951727503596`},{"",39.`,600.`,30.`,90.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00020395462973606115`,0.13499711179801763`,0.0008531787285278422`,0.8639457548437182`},{"",40.`,600.`,30.`,90.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.004024491120147288`,0.1025955282519457`,0.0075612542542700285`,0.8858187263736373`},{"",41.`,600.`,30.`,90.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0024092658486904064`,0.06636429331274787`,0.0034344598485287828`,0.9277919809900331`},{"",42.`,600.`,30.`,90.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00017063966845642275`,0.05865944347118788`,0.0010201329440587255`,0.940149783916297`},{"",43.`,600.`,45.`,0.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.03709324339021111`,0.00011239552506493605`,0.962563538620711`,0.00023082246401239512`},{"",44.`,600.`,45.`,0.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.021615071745888267`,0.003053816460797164`,0.968758695778929`,0.006572416014385959`},{"",45.`,600.`,45.`,0.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.008291687758541815`,0.0013111933208868433`,0.9875365725042851`,0.002860546416286648`},{"",46.`,600.`,45.`,0.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.006152940935852803`,0.0005932790502958414`,0.9919616666632831`,0.001292113350568589`},{"",47.`,600.`,45.`,0.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.014033085298112702`,0.004365592477085375`,0.9720608657639567`,0.009540456460845828`},{"",48.`,600.`,45.`,0.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.031431295240813145`,0.0018641149989473507`,0.9626622442155773`,0.00404234554466261`},{"",49.`,600.`,45.`,0.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.03709324339021114`,0.0007890243617577915`,0.9603797641007932`,0.0017379681472380576`},{"",50.`,600.`,45.`,90.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0007890243617577909`,0.09355089706981562`,0.00020071850802127968`,0.9054593600604057`},{"",51.`,600.`,45.`,90.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.005835263085364539`,0.12556308582616593`,0.005015670853335403`,0.8635859802351341`},{"",52.`,600.`,45.`,90.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.003037883479040915`,0.17496735754013604`,0.0022098158926675032`,0.8197849430881557`},{"",53.`,600.`,45.`,90.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0001502564340797323`,0.18826481796817449`,0.0009164598049920798`,0.8106684657927534`},{"",54.`,600.`,45.`,90.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.004076760033935862`,0.14915327967425898`,0.007030009938163327`,0.8397399503536417`},{"",55.`,600.`,45.`,90.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.002694152996024981`,0.10354735662667428`,0.00303771258063186`,0.8907207777966688`},{"",56.`,600.`,45.`,90.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00011239552506493588`,0.09355089706981562`,0.0012190850994102656`,0.9051176223057094`},{"",57.`,600.`,60.`,0.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.002929852916662563`,0.00006283188805492187`,0.9968511694427962`,0.00015614575248644227`},{"",58.`,600.`,60.`,0.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.000188532504519385`,0.002603110536060979`,0.9903056298886493`,0.0069027270707706645`},{"",59.`,600.`,60.`,0.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0031889811882248507`,0.0010177885389909289`,0.9930488490644899`,0.0027443812082943763`},{"",60.`,600.`,60.`,0.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.004895553796512123`,0.0006269319420506115`,0.9927989800726323`,0.0016785341888048417`},{"",61.`,600.`,60.`,0.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0008428098967128933`,0.004158011906763003`,0.9838047368194351`,0.011194441377089043`},{"",62.`,600.`,60.`,0.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0014655055647322748`,0.0017298103118592255`,0.9921850450617486`,0.00461963906166004`},{"",63.`,600.`,60.`,0.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0029298529166625433`,0.000943758024343579`,0.9935697539808035`,0.002556635078190485`},{"",64.`,600.`,60.`,90.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0009437580243435781`,0.1793650368833854`,0.00006971131332416406`,0.8196214937789463`},{"",65.`,600.`,60.`,90.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.006109523407477207`,0.22140956843407764`,0.0034163213293764653`,0.7690645868290689`},{"",66.`,600.`,60.`,90.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.003100413992360898`,0.28232420100810085`,0.0013542090330150847`,0.7132211759665233`},{"",67.`,600.`,60.`,90.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00009712388579147583`,0.2980045109036033`,0.0008695979818258081`,0.7010287672287794`},{"",68.`,600.`,60.`,90.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0037889316304138684`,0.25105112200227203`,0.005674566119989591`,0.7394853802473247`},{"",69.`,600.`,60.`,90.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0027925657646410197`,0.19272188481515473`,0.002310005372614801`,0.8021755440475891`},{"",70.`,600.`,60.`,90.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.00006283188805492146`,0.1793650368833854`,0.0013188845005204512`,0.819253246728039`},{"",71.`,600.`,75.`,0.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.07367559191649554`,0.000024613482977368704`,0.9261960118289938`,0.00010378277153285464`},{"",72.`,600.`,75.`,0.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.09192462267560657`,0.0015780035309751672`,0.8993161519758337`,0.0071812218175845285`},{"",73.`,600.`,75.`,0.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.11989176056188675`,0.0005511504653809443`,0.8770038850863457`,0.002553203886386711`},{"",74.`,600.`,75.`,0.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.12712794593273757`,0.0004279151563906553`,0.8704866145964318`,0.0019575243144403956`},{"",75.`,600.`,75.`,0.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.1054844850639555`,0.00270961460162112`,0.8793192167483168`,0.012486683586106651`},{"",76.`,600.`,75.`,0.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.07923838818087495`,0.0011455166646184545`,0.9143736040688217`,0.00524249108568522`},{"",77.`,600.`,75.`,0.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.07367559191649556`,0.0007578001089872947`,0.9220586274697278`,0.0035079805047892867`},{"",78.`,600.`,75.`,90.`,-90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.000757800108987293`,0.40337289689838834`,0.000050352047048282054`,0.5958189509455759`},{"",79.`,600.`,75.`,90.`,-60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.004346044349538628`,0.4502504119494909`,0.0016177095059995866`,0.5437858341949707`},{"",80.`,600.`,75.`,90.`,-30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0020843352469161027`,0.512236229509471`,0.0005776035272534955`,0.48510183171635957`},{"",81.`,600.`,75.`,90.`,0.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.000043724738971337515`,0.5271659564698282`,0.0005924831579760745`,0.4721978356332241`},{"",82.`,600.`,75.`,90.`,30.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.002421150994154217`,0.48127497670575564`,0.003182426121295988`,0.513121446178794`},{"",83.`,600.`,75.`,90.`,60.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.0020109896461867577`,0.41863411998119693`,0.0012327037346565014`,0.5781221866379594`},{"",84.`,600.`,75.`,90.`,90.`,0.`,7.`,-11.`,17.`,0.`,0.`,0.`,70.`,"",0.000024613482977368273`,0.40337289689838807`,0.0010755481334233396`,0.5955269414852109`}};

FuncList={Rx, Ry, Tx, Ty}; 
opts={UseThickLastLayer -> False,  PrintTimeEstimate -> True, RotateAll-> True,LambdaColumn -> 3, FitaColumn -> 4, BetaColumn ->5, GammaColumn -> 6, EllipticityColumn -> 7,OutputStartColumn -> 16,UseEvaluationMonitor -> True, EvaluationMonitorCount -> 25, PrintEpsilon -> False, EpsilonType->BIEPSTYPESTDTWOSTEPTRAPSPARENT,StepMonitorCount -> 1,EvaluationMonitorSecondStepCount -> 10,StepMonitorSecondStepCount -> 1};
(*, OutputColumns  {11} *)
Print["Starting..."];
OutputCopyright[];

invSol=InverseSolutionNew[600 nm,InptRefractionElement, {70 nm,0},InptList, FuncList, "No Description", opts];
(* Print["invSol = ", invSol]; *)

 eeExact = (2.2840136362091683`	-0.11015637957015396`	-0.10461665671201104`
-0.11015637957015395`	3.0176837156071232`	0.08117170060705126`
-0.10461665671201104`	0.08117170060705126`	2.7333026481837086`

); 
Print["========================="];
mf=MFHlp[eeExact, invSol];
Print["========================="];
Print["MF exact = ", mf];

Print["========================="];
epsMin=ProcessMinSolEps[eeExact, invSol];
Print["epsMin = ", epsMin];

(*
For[msDSTHlp = 0, msDSTHlp ≤2, msDSTHlp++,
Print["================================================================================================"];
Print["msDST", msDSTHlp];
Print["invSol[[1,4,msDST+1]] = ",invSol[[1,4,msDSTHlp+1]]];
Print["invSol[[1,4,msDST+1,1]] = ",invSol[[1,4,msDSTHlp+1,1]]];
Print["invSol[[1,4,msDST+1,2]] = ",invSol[[1,4,msDSTHlp+1,2]]];
Print["invSol[[1,4,msDST+1,3]] = ",invSol[[1,4,msDSTHlp+1,3]]];
];
*)

Print["========================="];
invSolRun=InverseSolutionRun[invSol]; 
